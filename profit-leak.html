<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Vizbix â€“ Profit Insights</title>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf.umd.min.js"></script>

<style>
:root{
  --bg:#f5f7fb;
  --card:#fff;
  --brand:#0f172a;
  --blue:#2563eb;
  --green:#16a34a;
  --border:#e2e8f0;
}

*{box-sizing:border-box;font-family:Inter,system-ui}
body{margin:0;background:var(--bg)}

main{
  max-width:1100px;
  margin:auto;
  padding:24px;
}

h1{
  text-align:center;
  font-weight:900;
  margin-bottom:25px;
}

.card{
  background:var(--card);
  border-radius:20px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 12px 30px rgba(0,0,0,.06);
}

.grid{
  display:grid;
  grid-template-columns:2fr 1fr 1fr 1fr auto;
  gap:10px;
  margin-bottom:10px;
}

input{
  padding:12px;
  border-radius:12px;
  border:1px solid var(--border);
}

button{
  border-radius:12px;
  padding:12px 16px;
  font-weight:700;
  cursor:pointer;
  border:none;
}

.primary{background:var(--brand);color:#fff}
.secondary{background:#fff;border:1px solid var(--border)}
.success{background:var(--green);color:#fff}

.big{
  font-size:34px;
  font-weight:900;
  text-align:center;
  margin-bottom:20px;
}

.locked{
  filter:blur(6px);
  opacity:.4;
  pointer-events:none;
}

.insight{
  padding:12px;
  border-radius:12px;
  margin-bottom:8px;
  font-weight:600;
  background:#eef2ff;
}

table{
  width:100%;
  margin-top:15px;
  border-collapse:collapse;
}
td,th{
  padding:10px;
  border-bottom:1px solid var(--border);
}

.tools{
  display:flex;
  gap:10px;
  margin-top:15px;
  flex-wrap:wrap;
}
</style>
</head>

<body>
<main>

<h1>ðŸ“Š Vizbix â€¢ Profit Insights</h1>

<div class="card">
  <input id="emailInput" placeholder="Email for Pro insights" style="margin-bottom:14px">

  <div id="items"></div>

  <div class="tools">
    <button class="secondary" onclick="addRow()">+ Add Product</button>
    <button class="secondary" onclick="loadSample()">âœ¨ Sample Data</button>
    <button class="primary" onclick="analyze()">Analyze Profit</button>
  </div>
</div>

<div id="results" class="card" style="display:none">
  <div id="profitText" class="big"></div>

  <div id="lockBox">
    <button class="primary" onclick="pay()">Unlock Pro â€“ â‚¹299</button>
    <button class="secondary" onclick="verify()">Verify</button>
  </div>

  <div id="proContent" class="locked">
    <div id="insights"></div>
    <table id="table"></table>
    <canvas id="chart"></canvas>

    <div class="tools">
      <button class="secondary" onclick="downloadPDF()">ðŸ“„ Export PDF</button>
    </div>
  </div>
</div>

</main>

<script>
const items = document.getElementById("items");
const results = document.getElementById("results");
const profitText = document.getElementById("profitText");
const insights = document.getElementById("insights");
const table = document.getElementById("table");
const proContent = document.getElementById("proContent");
const lockBox = document.getElementById("lockBox");

let chart;

/* Add row */
function addRow(){
  const d=document.createElement("div");
  d.className="grid";
  d.innerHTML=`
    <input placeholder="Product">
    <input type="number" placeholder="Sell">
    <input type="number" placeholder="Cost">
    <input type="number" placeholder="Qty">
    <button onclick="this.parentElement.remove()">âœ•</button>
  `;
  items.appendChild(d);
}

/* Sample data */
function loadSample(){
  items.innerHTML="";
  const sample=[
    ["Shirt",999,500,40],
    ["Shoes",1999,1100,25],
    ["Cap",499,200,60]
  ];
  sample.forEach(s=>{
    addRow();
    const r=items.lastElementChild.querySelectorAll("input");
    r[0].value=s[0];
    r[1].value=s[1];
    r[2].value=s[2];
    r[3].value=s[3];
  });
}

/* Analyze */
function analyze(){
  let data=[];
  let total=0;

  document.querySelectorAll(".grid").forEach(r=>{
    const i=r.querySelectorAll("input");
    const name=i[0].value;
    const sell=+i[1].value;
    const cost=+i[2].value;
    const qty=+i[3].value;

    const profit=(sell-cost)*qty;
    const margin=(sell-cost)/sell;

    total+=profit;
    data.push({name,sell,cost,qty,profit,margin});
  });

  window.data=data;
  results.style.display="block";
  profitText.innerText="Estimated Profit: â‚¹ "+total;

  generateTable(data);
  generateChart(data);
  generateInsights(data);
}

/* Insights */
function generateInsights(d){
  const best=[...d].sort((a,b)=>b.profit-a.profit)[0];
  const monthly=d.reduce((a,b)=>a+b.profit,0)*30;

  insights.innerHTML=`
    <div class="insight">ðŸš€ Focus on ${best.name} (highest profit)</div>
    <div class="insight">ðŸ“… Monthly projection â‰ˆ â‚¹${monthly}</div>
  `;
}

/* Table */
function generateTable(d){
  table.innerHTML="<tr><th>Product</th><th>Profit</th><th>Margin</th></tr>";
  d.forEach(x=>{
    table.innerHTML+=`
      <tr>
        <td>${x.name}</td>
        <td>â‚¹${x.profit}</td>
        <td>${(x.margin*100).toFixed(0)}%</td>
      </tr>
    `;
  });
}

/* Chart */
function generateChart(d){
  if(chart) chart.destroy();

  chart=new Chart(document.getElementById("chart"),{
    type:"bar",
    data:{
      labels:d.map(x=>x.name),
      datasets:[{data:d.map(x=>x.profit)}]
    },
    options:{plugins:{legend:{display:false}}}
  });
}

/* PDF export â€“ FIXED */
function downloadPDF(){
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF();

  doc.text("Vizbix Profit Report",20,20);

  let y=40;

  window.data.forEach(x=>{
    doc.text(`${x.name} | Profit â‚¹${x.profit}`,20,y);
    y+=10;
  });

  doc.save("profit-report.pdf");
}

/* initial rows */
addRow();
addRow();
addRow();
</script>
</body>
</html>
